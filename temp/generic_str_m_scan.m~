m_min = 1; m_step = 0.2; m_max = 6;
model = mccode('generic_straight.instr');
name = 'H3-0-DEDM';
parameters.guide_length=12;
parameters.sample_width=0.03;
parameters.sample_height=0.1;
parameters.guide_start_width=0.03;
parameters.guide_start_height=0.1;
parameters.source_lambda_min=4.85;
parameters.source_lambda_max=4.95;
parameters.cold_regime=1;



parameters.m_side = m_min:m_step:m_max;
parameters.m_top = 1;
results_side = iData(model,parameters);
sum_side = sum(results_side, 0);

parameters.m_side = 1;
parameters.m_top = m_min:m_step:m_max;
results_top = iData(model,parameters);
sum_top = sum(results_top, 0);

figure;
plot(m_min:m_step:m_max,sum_side,m_min:m_step:m_max,sum_top,'LineWidth',2);
title([name 'scan m'])
grid on
xlabel('m')
ylabel('I, arb.u.')
legend('side','top')
print(gcf,strjoin({[name 'm_scan'],'-dpng','-r300')
figname = ['figs/' instr_name '_' model_name '_height_scan_' num2str(lambda_min) 'AA' ];
matlab2tikz([figname '.tex'], 'width', '0.85\textwidth');
saveas(fig, [figname '.fig']);